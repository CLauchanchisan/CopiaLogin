<app-header></app-header>
<ion-content>

  <!-- <ion-item class="buscador"> -->
  <ion-searchbar
    placeholder="BUSCAR ICAO"
    (ionChange)="buscar($event)"
    class="buscador"
  ></ion-searchbar>
  <!-- </ion-item> -->

  <ion-list *ngFor="let aeropuerto of aeropuertos?.data">

    <div class="contenedor-clima">

      <!-- boton de favoritos -->
      <ion-button class="favorite-button-container" fill="clear" (click)="addToFavorites(aeropuerto)" [ngClass]="{'favorite': isFavorite[aeropuerto.icao]}">
        <ion-icon [name]="isFavorite[aeropuerto.icao] ? 'star' : 'star-outline'"></ion-icon>
      </ion-button>

      <!-- nombres de aeropuertos -->
      <div class="aeropuerto">
        <h1>{{ aeropuerto.station.name }}</h1>
        <h2>{{ aeropuerto.icao }} - {{ aeropuerto.station.location }}</h2>

      </div>
      <!-- lista cuando usas el buscador -->
      <div class="datos">
        <span>Temperatura: {{ aeropuerto.temperature.celsius }}°</span>
        <span>Nubes: {{ aeropuerto.clouds[0].text }}</span>
        <span
          >Viento: {{ aeropuerto.wind.degrees }}°/{{
            aeropuerto.wind.speed_kts
          }}Kts</span
        >
        <span>Visibilidad: {{ aeropuerto.visibility.meters }} Metros</span>
        <span>Presion: {{ aeropuerto.barometer.hpa }}hPa</span>
      </div>
    </div>
  </ion-list>

  <div class="ubicacion-container">
    <ion-button class="ubicacion-button" (click)="mostrarUbicacion = true; obtenerUbicacion()">
      <ion-icon name="location-outline" slot="start"></ion-icon>
      Obtener Ubicación
    </ion-button>
  
    <div *ngIf="mostrarUbicacion && pais && provincia" class="ubicacion-info">
      <p><strong>País:</strong> {{ pais }}</p>
      <p><strong>Provincia:</strong> {{ provincia }}</p>
    </div>
  
    <div *ngIf="mostrarUbicacion && (!pais && !provincia)" class="ubicacion-error">
      <p>Ubicación no disponible.</p>
    </div>

  <div *ngIf="aeropuertoCercano; else noAeropuertoCercano">
    <h2>Aeropuerto más cercano: </h2>
    <div class="contenedor-clima">
      <p>Nombre: {{ aeropuertoCercano.station ? aeropuertoCercano.station.name : 'Desconocido' }}</p>
      <p>ICAO: {{ aeropuertoCercano.icao }}</p>
      <p>Ciudad: {{ aeropuertoCercano.city }}</p>
      <p>País: {{ aeropuertoCercano.country.name }}</p>
    </div>
  </div>

  <ng-template #noAeropuertoCercano>
    <div class="no-aeropuerto">
      <h2>No se encontró un aeropuerto cercano</h2>
    </div>
  </ng-template>
</div>
  
  <!-- <div *ngIf="latitud !== null && longitud !== null" class="ubicacion-info">
    <p>Latitud: {{ latitud }}</p>
    <p>Longitud: {{ longitud }}</p>
  </div>
   -->
  
</ion-content>
<app-footer></app-footer>

<!-- "navegación segura" (?.) para acceder a las propiedades de aeropuertoCercano. Esto evitará que Angular intente leer propiedades de un objeto undefined: -->
